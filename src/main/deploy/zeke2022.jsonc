//
// This is the settings file for the Zeke robot.  
//
// If the comments are causing lots of red markers in this file, you
// need to change your JSON handling in VSCode to JSONC.  Do this by
// selecting File/Preferences/Settings.  Select Text Editor/Files
// and in the files section, add an entry "*.json" and "jsonc"
//
{
    "system": {
        //
        // This section controls messages sent to the log file.  The log file
        // is stored on a USB stick on the RoboRio, or in the logs subdirectory
        // in the robot code if running a simulation.
        //
        "messages": {
            // Robot framework settings settings
            "actions": true,
            "pathmanager": false,
            "xerorobot": false,

            // Tank drive related settings
            "pathfollowing": false,
            "tankdrive": false,

            // Turrent/Limelight/Aiming related
            "zeke_limelight": false,

            // Ball path related
            "zeke-color-sensor": false,
            "intake": false,
            "conveyor": false,

            // Shoot related
            "shooter": false,
            "fire-action-ready" : false,
            "fire-action-shoot-params" : false,
            "fire-action-shoot-performance": false,
            "shooter-w1" : false,
            "shooter-w2" : false,
            "shooter-h" : true,
            "turret" : false,

            // Climber related
            "climber": false,
            "climber-model": false,

            // OI
            "zekeoi" : false
        },
        //
        // This section controls, what data shows up on the smart dashboard when the item has a
        // display type of DisplayType.Verbose.
        //
        "verbose": {
            "tankdrive": false,
            "shooter-w2" : true,
            "shooter-w1" : true
        },
        //
        // Enable plotting for actions that support plotting
        //
        "plotting": true,
        //
        // The global pneumatics settings for the robot
        //
        "pneumatics": {
            "type": "REVPH",
            "min-pressure": 105.0,
            "max-pressure": 120.0
        }
    },
    // This section describes the subsystems on the robot
    "subsystems": {
        "tankdrive": {
            "hw": {
                "gyro": "navx",
                "left": {
                    "motors": {
                        "1": {
                            "type": "talon_fx",
                            "canid": 1
                        },
                        "2": {
                            "type": "talon_fx",
                            "canid": 2
                        }
                    }
                },
                "right": {
                    "motors": {
                        "1": {
                            "type": "talon_fx",
                            "canid": 3
                        },
                        "2": {
                            "type": "talon_fx",
                            "canid": 4
                        },
                        "inverted": true
                    }
                }
            },
            // "current_limit" : 10.0,
            "width": 30,
            "scrub": 1.0,
            "inches_per_tick": 0.000814006,
            "speedometer": {
                "linearsamples": 2,
                "angluarsamples": 2
            },
            "follower": {
                "left": {
                    "ka": 0.0003,
                    "kv": 0.005740528,
                    "kp": 0.035,
                    "kd": 0.0
                },
                "right": {
                    "ka": 0.0003,
                    "kv": 0.005740528,
                    "kp": 0.035,
                    "kd": 0.0
                }
            },
            "angle_correction": {
                "kp": 0.03,
                "ki": 0.0,
                "kd": 0.0,
                "kf": 0,
                "max": 1.0,
                "min": -1.0,
                "imax": 0.0
            }
        },
        "zekeoi": {
            "xero1425_gamepad": {
                "index_not_yes": 0,
                "power": {
                    "max": 1.0,
                    "default": 0.6,
                    "nudge_straight": 0.2,
                    "nudge_rotate": 0.2,
                    "slowby": 0.5,
                    "tolerance": 0.05
                },
                "turn": {
                    "max": 0.8,
                    "default": 0.4
                },
                "zerolevel": 0.1,
                "nudge_time": 0.1
            },
            "standard_gamepad": {
                "index": 0,
                "deadband": 0.05,
                "epsilon": 0.05
            },
            "oi": {
                "index": 2,
                "gadgets": {
                    "automode": 0,
                    "shoot_collect_mode": 6,
                    "collect_onoff": 3,
                    "climb_lock": 4,
                    "climb": 9,
                    "deploy_climber" : 7,
                    "force_shoot" : 1,
                    "eject" : 2,
                    "shoot_manual_mode" : 5,
                    "throughput" : 8
                },
                "outputs" : {
                    "ball1" : 1,
                    "ball2" : 2,
                    "climber-deploying" : 3,
                    "climber-deployed" : 4,
                    "climber-climbing" : 5,
                    "climber-climbed" : 6
                }
            }
        },
        "gpm" : {
            "fire-action" : {
                "hood_pos_threshold" : 10.0,
                "db_vel_threshold" : 6.0,
                "shooter_vel_threshold" : 80.0,
                "shutdown-delay" : 1.0
            },
            "manual-fire-action" : {
                "w1" : 2000,
                "w2" : 2000,
                "hood" : 8
            }
        },
        "intake": {
            "intake-on": {
                "in_speed": 0.8,
                "out_slow": -0.2,
                "out_fast": -0.7,
                "blocked_count": 10,
                "blocked_duration": 1.0,
                "move_left_duration": 0.4,
                "eject_duration": 1.0
            },
            "hw": {
                "solenoids": {
                    "deploy": 8
                },
                "collector": {
                    "motor-left": {
                        "type": "sparkmax_brushless",
                        "canid": 7
                    },
                    "motor-right": {
                        "type": "sparkmax_brushless",
                        "canid": 8,
                        "inverted" : true
                    },
                    "in_speed": 1,
                    "out_slow": 0.3,
                    "out_fast": -1,
                    "stopped": 0
                }
            }
        },
        "conveyor": {
            "hw": {
                "motors": {
                    "intake": {
                        "type": "sparkmax_brushless",
                        "canid": 6
                    },
                    "shooter": {
                        "type": "sparkmax_brushless",
                        "canid": 5,
                        "inverted" : true
                    }
                },
                "solenoids": {
                    "exit": 3
                },
                "sensors": {
                    "intake": 3,
                    "exit": 1,
                    "chimney": 2,
                    "shooter": 0
                }
            },
            "power" : {
                "intake" : 1.0,
                "shooter" : 1.0
            },
            "eject-action" : {
                "power" : -1.0,
                "duration" : 1.5
            },
            "shoot-action" : {
                "second-ball-delay" : 1.0
            }
        },
        "turret": {
            "hw": {
                "motors": {
                    "type": "sparkmax_brushless",
                    "canid": 11
                },
                "encoder": {
                    "type": "analog",
                    "ainput": 1,
                    "rmin": -180.0,
                    "rmax": 180.0,
                    "emin": 0.0,
                    "emax": 5.0,
                    "ec": {
                        "COMPETITION": 2.46,
                        "PRACTICE": 0.62133
                    },
                    "rc": 0.0
                }
            },
            "goto": {
                "threshold": 1.5,
                "maxa": 250,
                "maxd": -250,
                "maxv": 250
            },
            "follower": {
                "up": {
                    "kp": 0.001,
                    "ka": 0.0,
                    "ki": 0.0,
                    "kd": 0.0,
                    "kv": 0.003211991
                },
                "down": {
                    "kp": 0.001,
                    "ka": 0.0,
                    "ki": 0.0,
                    "kd": 0.0,
                    "kv": 0.003211991
                }
            },
            "follow": {
                "kp": 0.014084508,
                "ki": 0,
                "kd": 0,
                "kf": 0,
                "min": -1,
                "max": 1,
                "imax": 0.0
            },
            "hold": {
                "kp": 0.001,
                "ki": 0,
                "kd": 0,
                "kf": 0,
                "min": -0.3,
                "max": 0.3,
                "imax": 0.0
            },
            "min": -60,
            "max": 60,
            "fire_threshold": 5.0
        },
        "zeke_limelight": {
            "timeout": 8.0,
            "camera_latency": 0.011,
            "network_latency": 0.010,
            "camera_angle": 27.5,
            "camera_height": 51.0,
            "target_height": 102
        },
        "targettracker": {
            "camera_offset_angle": -1.5,
            "lost_count": 10,
            "track_method": "vf"
        },
        "climber": {
            "hw": {
                "solenoids": {
                    "clamp_a": {
                        "forward": 1,
                        "reverse": 0
                    },
                    "clamp_b": {
                        "forward": 14,
                        "reverse": 15
                    }
                },
                "motors": {
                    "1": {
                        "type": "sparkmax_brushless",
                        "canid": 13,
                        "neutral_mode" : "coast"
                    },
                    "2": {
                        "type": "sparkmax_brushless",
                        "canid": 14,
                        "neutral_mode" : "coast",
                        "inverted": true                        
                    }
                },
                "encoder": {
                    "type": "motor",
                    "m": 0.039717564,
                    "b": 0.0
                },
                "touchsensors": {
                    "left_a": 6,
                    "right_a": 7,
                    "left_right_b": 9
                },
                "windmill": {
                    "windmill_power_forwards": 0.3,
                    "windmill_power_backwards": -0.2,
                    "windmill_power_off": 0.0
                }
            },

            //
            // Parameters for a PID controller used by the MotorEncoderTrackPosition action
            //
            "backup": {
                "kp": 0.00001,
                "ki": 0.0,
                "kd": 0.0,
                "kf": 0.006339144,
                "max": 1.0,
                "min": -1.0,
                "imax": 0.0
            },

            //
            // Used by the MotorEncoderGotoAction to compute the trapezoidal speed profile
            //
            "goto": {
                "threshold": 2.5,
                "maxa": 45,
                "maxd": -45,
                "maxv": 45
            },

            //
            // Used by the MotorEncoderGotoAction to follow the trapezoidal speed profile
            //
            "follower": {

                "up": {
                    "kp": 0.01,
                    "ka": 0.0,
                    "ki": 0.0,
                    "kd": 0.0,
                    "kv": 0.006339144
                },
                "down": {
                    "kp": 0.01,
                    "ka": 0.0,
                    "ki": 0.0,
                    "kd": 0.0,
                    "kv": 0.006339144
                }
            },

            //
            // Used by the MotorEncoderHoldAction to hold the climber in place
            //
            "hold": {
                "kp": 0.001,
                "ki": 0,
                "kd": 0,
                "kf": 0.0,
                "min": -0.3,
                "max": 0.3,
                "imax": 0.0
            },

            //
            // Parameters for the climb actions
            //
            "climbaction": {
                "drive_action_power": 0.2,
                "first_clamp_wait": 2.0,
                "second_clamp_wait": 2.0,
                "first_unclamp_wait": 2.0,
                "second_unclamp_wait": 2.0,
                "backup-power" : -0.6,
                "backup-duration" : 0.3
            },
            "deploy-action" : {
                "deployed" : 90,
                "stowed" : -15
            },
            "change-clamp-action" : {
                "wait_time" : 1.0
            }
        },
        "shooter": {
            "shooter-action": {
                "wheel-velocity-threshold": 10,
                "hood-position-threshold": 10
            }
        },
        "shooter-w1": {
            "hw": {
                "motors": {
                    "type": "sparkmax_brushless",
                    "canid": 9
                },
                "encoder": {
                    "type": "motor",
                    "m": 2.857,
                    "b": 0.0
                }
            },
            "w1": {
                "kp": 0.00017,
                "ki": 0.0,
                "kd": 0.0,
                "kf": 1.0039152695512498745105913060938e-4,
                "max": 1.0,
                "min": -1.0,
                "imax": 0.0
            }
        },
        "shooter-w2": {
            "hw": {
                "motors": {
                    "type": "sparkmax_brushless",
                    "canid": 10,
                    "inverted": true
                },
                "encoder": {
                    "type": "motor",
                    "m": 2.857,
                    "b": 0.0
                }
            },
            "w2": {
                "kp": 0.00017,
                "ki": 0.0,
                "kd": 0.0,
                "kf": 1.0188487009679062659195109526235e-4,
                "max": 1.0,
                "min": -1.0,
                "imax": 0.0
            }
        },
        "shooter-h": {
            // Valid raw analog range 1.03 - 4.0
            "hw": {
                "motors": {
                    "type": "sparkmax_brushless",
                    "canid": 12
                },
                "encoder": {
                    "type": "analog",
                    "ainput": 0,
                    "rmin": 1,
                    "rmax": 26,
                    "emin": 1.184,
                    "emax": 4.082,
                    "ec": {
                        "COMPETITION": 1.184,
                        "PRACTICE": 0.62133
                    },
                    "rc": 1
                }
            },
            "hood": {
                "kp": 0.15,
                "ki": 0.0,
                "kd": 0.0,
                "kf": 0.0,
                "max": 0.4,
                "min": -0.4,
                "imax": 0.0
            },
            "maxpos" : 22.0,
            "minpos" : 1.0
        },
        "zeke-color-sensor": {
            "hw": {
                "i2cmux": {
                    "address": 112,
                    "count": 3
                }
            },
            "intake-left-index": 1,
            "intake-right-index": 0,
            "conveyor-index": 2,
            "colors": {
                "red-ball": {
                    "r": 0.53,
                    "g": 0.34,
                    "b": 0.12
                },
                "blue-ball": {
                    "r": 0.14,
                    "g": 0.39,
                    "b": 0.46
                },
                "no-ball": {
                    "r": 0.25,
                    "g": 0.47,
                    "b": 0.27
                }
            }
        }
    },
    "testmode": {
        "enabled": true,
        "which": 101,
        "power": 0.4,
        "duration": 2.0,
        "distance": 22,
        "name": "far_tarmac_4_ball_1"
    }
}
